{% extends 'serve_base.html' %}

{% block head %}
<title>{{ user_name }}'s Serve Practice</title>
{% endblock %}

{% block body %}
<div class="content">
    <p style="display: none;">User ID: {{ u }}</p>
    
    {% block first_part %}
    {% endblock %}

    <div class="form">
        <form action="{% block form_action %}{% endblock %}?u={{ u }}" method="POST">
            <table>
                <tr style="background-color: lightgrey;">
                    <td>Date:</td>
                    <td><input type="text" name="date" id="date" value="{% block form_date %}{% endblock %}"></td>
                </tr>
                <tr>
                    <td class="user_input" style="color: green;">First In:</td>
                    <td><input type="text" name="first_serve_in" id="first_serve_in" value="{% block form_first_serve_in %}{% endblock %}" inputmode="numeric"></td>
                </tr>
                <tr>
                    <td class="sub_serve" style="color: green;">FI Deuce:</td>
                    <td><input type="text" name="first_serve_in_deuce" id="first_serve_in_deuce" value="{% block form_first_serve_in_deuce %}{% endblock %}" inputmode="numeric"></td>
                </tr>
                <tr>
                    <td class="sub_serve" style="color: darkred;">FO Deuce:</td>
                    <td><input type="text" name="first_serve_out_deuce" id="first_serve_out_deuce" value="{% block form_first_serve_out_deuce %}{% endblock %}" inputmode="numeric"></td>
                </tr>
                <tr>
                    <td class="user_input" style="color: darkred;">First Out:</td>
                    <td><input type="text" name="first_serve_out" id="first_serve_out" value="{% block form_first_serve_out %}{% endblock %}" inputmode="numeric"></td>
                </tr>
                <tr>
                    <td class="sub_serve" style="color: green;">FI Advantage:</td>
                    <td><input type="text" name="first_serve_in_ad" id="first_serve_in_ad" value="{% block form_first_serve_in_ad %}{% endblock %}" inputmode="numeric"></td>
                </tr>
                <tr>
                    <td class="sub_serve" style="color: darkred;">FO Advantage:</td>
                    <td><input type="text" name="first_serve_out_ad" id="first_serve_out_ad" value="{% block form_first_serve_out_ad %}{% endblock %}" inputmode="numeric"></td>
                </tr>
                <tr style="background-color:lightgray;">
                    <td>First Percent:</td>
                    <td class="serve-percent"><input type="text" name="first_serve_in_percent" id="first_serve_in_percent" value="{% block form_first_serve_in_percent %}{% endblock %}" inputmode="numeric"><span>%</span></td>
                </tr>
                <tr style="background-color:lightgray;">
                    <td class="sub_serve">Deuce:</td>
                    <td class="serve-percent"><input type="text" name="first_serve_in_percent_deuce" id="first_serve_in_percent_deuce" value="{% block form_first_serve_in_percent_deuce %}{% endblock %}" inputmode="numeric"><span>%</span></td>
                </tr>
                <tr style="background-color:lightgray;">
                    <td class="sub_serve">Advantage:</td>
                    <td class="serve-percent"><input type="text" name="first_serve_in_percent_ad" id="first_serve_in_percent_ad" value="{% block form_first_serve_in_percent_ad %}{% endblock %}" inputmode="numeric"><span>%</span></td>
                </tr>
                <tr>
                    <td class="user_input" style="color: lightgreen;">Second In:</td>
                    <td><input type="text" name="second_serve_in" id="second_serve_in" value="{% block form_second_serve_in %}{% endblock %}" inputmode="numeric"></td>
                </tr>
                <tr>
                    <td class="sub_serve" style="color: lightgreen;">SI Deuce:</td>
                    <td><input type="text" name="second_serve_in_deuce" id="second_serve_in_deuce" value="{% block form_second_serve_in_deuce %}{% endblock %}" inputmode="numeric"></td>
                </tr>
                <tr>
                    <td class="sub_serve" style="color: red;">SO Deuce:</td>
                    <td><input type="text" name="second_serve_out_deuce" id="second_serve_out_deuce" value="{% block form_second_serve_out_deuce %}{% endblock %}" inputmode="numeric"></td>
                </tr>
                <tr>
                    <td class="user_input" style="color: red;">Second Out:</td>
                    <td><input type="text" name="second_serve_out" id="second_serve_out" value="{% block form_second_serve_out %}{% endblock %}" inputmode="numeric"></td>
                </tr>
                <tr>
                    <td class="sub_serve" style="color: lightgreen;">SI Advantage:</td>
                    <td><input type="text" name="second_serve_in_ad" id="second_serve_in_ad" value="{% block form_second_serve_in_ad %}{% endblock %}" inputmode="numeric"></td>
                </tr>
                <tr>
                    <td class="sub_serve" style="color: red;">SO Advantage:</td>
                    <td><input type="text" name="second_serve_out_ad" id="second_serve_out_ad" value="{% block form_second_serve_out_ad %}{% endblock %}" inputmode="numeric"></td>
                </tr>
                <tr style="background-color:lightgray;">
                    <td>Second Percent:</td>
                    <td class="serve-percent"><input type="text" name="second_serve_in_percent" id="second_serve_in_percent" value="{% block form_second_serve_in_percent %}{% endblock %}" inputmode="numeric"><span>%</span></td>
                </tr>
                <tr style="background-color:lightgray;">
                    <td class="sub_serve">Deuce:</td>
                    <td class="serve-percent"><input type="text" name="second_serve_in_percent_deuce" id="second_serve_in_percent_deuce" value="{% block form_second_serve_in_percent_deuce %}{% endblock %}" inputmode="numeric"><span>%</span></td>
                </tr>
                <tr style="background-color:lightgray;">
                    <td class="sub_serve">Advantage:</td>
                    <td class="serve-percent"><input type="text" name="second_serve_in_percent_ad" id="second_serve_in_percent_ad" value="{% block form_second_serve_in_percent_ad %}{% endblock %}" inputmode="numeric"><span>%</span></td>
                </tr>
                <tr>
                    <td class="user_input">Total In:</td>
                    <td><input type="text" name="total_serve_in" id="total_serve_in" value="{% block form_total_serve_in %}{% endblock %}" inputmode="numeric"></td>
                </tr>
                <tr>
                    <td class="user_input">Total Out:</td>
                    <td><input type="text" name="total_serve_out" id="total_serve_out" value="{% block form_total_serve_out %}{% endblock %}" inputmode="numeric"></td>
                </tr>
                <tr style="background-color:lightgray;">
                    <td>Total Percent:</td>
                    <td class="serve-percent"><input type="text" name="total_serve_percent" id="total_serve_percent" value="{% block form_total_serve_percent %}{% endblock %}" inputmode="numeric"><span>%</span></td>
                </tr>
                <tr>
                    <td class="user_input">Total:</td>
                    <td><input type="text" name="total_serve" id="total_serve" value="{% block form_total_serve %}{% endblock %}" inputmode="numeric"></td>
                </tr>
                <tr>
                    <td class="user_input">Duration in minutes:</td>
                    <td><input type="text" name="duration" id="duration" value="{% block form_duration %}{% endblock %}" inputmode="numeric"></td>
                </tr>
                <tr>
                    <td class="user_input">Location:</td>
                    <td><input type="text" name="location" id="location" value="{% block form_location %}{% endblock %}"></td>
                </tr>
                <tr>
                    <td class="user_input">Comment:</td>
                    <td><input type="text" name="comment" id="comment" value="{% block form_comment %}{% endblock %}"></td>
                </tr>
            </table>
            <br>
            <div class="container">
                <input class="iphone-button" type="submit" value="Submit">
            </div>
        </form>
    </div>
</div>

<script>
    // Get today's date
    var today = new Date();
    
    // Format the date as YYYY-MM-DD
    var formattedDate = today.getFullYear() + '-' + (today.getMonth() + 1).toString().padStart(2, '0') + '-' + today.getDate().toString().padStart(2, '0');
    
    // Set the value of the input field with today's date
    if (!document.getElementById('date').value) {
        document.getElementById('date').value = formattedDate;
    }

    // Function to calculate the first serve percentage
    function calculateFirstServePercentage() {
        var firstServeIn = parseFloat(document.getElementById('first_serve_in').value);
        var firstServeOut = parseFloat(document.getElementById('first_serve_out').value);
        
        // Check if inputs are valid numbers
        if (!isNaN(firstServeIn) && !isNaN(firstServeOut) && (firstServeIn + firstServeOut !== 0)) {
            // Calculate the percentage and round it to the nearest integer
            var percentage = Math.round((firstServeIn / (firstServeIn + firstServeOut)) * 100);
            // Update the span with the calculated percentage
            document.getElementById('first_serve_in_percent').value = percentage;
        } else {
            // If inputs are not valid, display an empty percentage
            document.getElementById('first_serve_in_percent').value = "";
        }

        calculateTotalServe();
    }

    // Add event listeners to the input fields
    document.getElementById('first_serve_in').addEventListener('input', calculateFirstServePercentage);
    document.getElementById('first_serve_out').addEventListener('input', calculateFirstServePercentage);

    // Initial calculation when the page loads
    calculateFirstServePercentage();

    function calculateSecondServePercentage() {
        var secondServeIn = parseFloat(document.getElementById('second_serve_in').value);
        var secondServeOut = parseFloat(document.getElementById('second_serve_out').value);
        
        // Check if inputs are valid numbers
        if (!isNaN(secondServeIn) && !isNaN(secondServeOut) && (secondServeIn + secondServeOut !== 0)) {
            // Calculate the percentage and round it to the nearest integer
            var percentage = Math.round((secondServeIn / (secondServeIn + secondServeOut)) * 100);
            // Update the span with the calculated percentage
            document.getElementById('second_serve_in_percent').value = percentage;
        } else {
            // If inputs are not valid, display an empty percentage
            document.getElementById('second_serve_in_percent').value = "";
        }

        calculateTotalServe();
    }

    // Add event listeners to the input fields
    document.getElementById('second_serve_in').addEventListener('input', calculateSecondServePercentage);
    document.getElementById('second_serve_out').addEventListener('input', calculateSecondServePercentage);

    // Initial calculation when the page loads
    calculateSecondServePercentage();

    // Function to calculate total serve statistics
    function calculateTotalServe() {
        var firstServeIn = parseFloat(document.getElementById('first_serve_in').value);
        var firstServeOut = parseFloat(document.getElementById('first_serve_out').value);
        var secondServeIn = parseFloat(document.getElementById('second_serve_in').value);
        var secondServeOut = parseFloat(document.getElementById('second_serve_out').value);
        
        var totalServeInValue = parseFloat(document.getElementById('total_serve_in').value);
        var totalServeOutValue = parseFloat(document.getElementById('total_serve_out').value);

        // Calculate total serve in and update the input field
        var totalServeIn = (isNaN(firstServeIn) ? 0 : firstServeIn) + (isNaN(secondServeIn) ? 0 : secondServeIn);
        if (totalServeIn > 0) {
            document.getElementById('total_serve_in').value = totalServeIn;
        } else {
            totalServeIn = totalServeInValue;
        }
        
        // Calculate total serve out and update the input field
        var totalServeOut = (isNaN(firstServeOut) ? 0 : firstServeOut) + (isNaN(secondServeOut) ? 0 : secondServeOut);
        if (totalServeOut > 0) {
            document.getElementById('total_serve_out').value = totalServeOut;
        } else {
            totalServeOut = totalServeOutValue;
        }
        
        // Calculate total serve
        var totalServe = totalServeIn + totalServeOut;
        if (totalServe > 0) {
            document.getElementById('total_serve').value = totalServe;
        }

        // Check if inputs are valid numbers
        if (!isNaN(totalServeIn) && !isNaN(totalServeOut) && (totalServeIn + totalServeOut !== 0)) {
            // Calculate the percentage and round it to the nearest integer
            var percentage = Math.round((totalServeIn / (totalServeIn + totalServeOut)) * 100);
            // Update the span with the calculated percentage
            document.getElementById('total_serve_percent').value = percentage;
        } else {
            // If inputs are not valid, display an empty percentage
            document.getElementById('total_serve_percent').value = "";
        }
    }

    // Add event listeners to the input fields
    document.getElementById('total_serve_in').addEventListener('input', calculateTotalServe);
    document.getElementById('total_serve_out').addEventListener('input', calculateTotalServe);

    // ============== first serve
    function calculateFirstServe() {
        var firstServeInDeuce = parseFloat(document.getElementById('first_serve_in_deuce').value);
        var firstServeOutDeuce = parseFloat(document.getElementById('first_serve_out_deuce').value);
        var firstServeInAd = parseFloat(document.getElementById('first_serve_in_ad').value);
        var firstServeOutAd = parseFloat(document.getElementById('first_serve_out_ad').value);

        var firstServeIn = (isNaN(firstServeInDeuce) ? 0 : firstServeInDeuce) + (isNaN(firstServeInAd) ? 0 : firstServeInAd);
        if (firstServeIn > 0) {
            document.getElementById('first_serve_in').value = firstServeIn;
        }

        var firstServeOut = (isNaN(firstServeOutDeuce) ? 0 : firstServeOutDeuce) + (isNaN(firstServeOutAd) ? 0 : firstServeOutAd);
        if (firstServeOut > 0) {
            document.getElementById('first_serve_out').value = firstServeOut;
        }
    }

    // First Deuce
    function calculateFirstServePercentageDeuce() {
        var firstServeIn = parseFloat(document.getElementById('first_serve_in_deuce').value);
        var firstServeOut = parseFloat(document.getElementById('first_serve_out_deuce').value);
        
        // Check if inputs are valid numbers
        if (!isNaN(firstServeIn) && !isNaN(firstServeOut) && (firstServeIn + firstServeOut !== 0)) {
            // Calculate the percentage and round it to the nearest integer
            var percentage = Math.round((firstServeIn / (firstServeIn + firstServeOut)) * 100);
            // Update the span with the calculated percentage
            document.getElementById('first_serve_in_percent_deuce').value = percentage;
        } else {
            // If inputs are not valid, display an empty percentage
            document.getElementById('first_serve_in_percent_deuce').value = "";
        }

        calculateFirstServe();
        calculateFirstServePercentage();
    }

    // Add event listeners to the input fields
    document.getElementById('first_serve_in_deuce').addEventListener('input', calculateFirstServePercentageDeuce);
    document.getElementById('first_serve_out_deuce').addEventListener('input', calculateFirstServePercentageDeuce);

    function calculateFirstServePercentageAd() {
        var firstServeIn = parseFloat(document.getElementById('first_serve_in_ad').value);
        var firstServeOut = parseFloat(document.getElementById('first_serve_out_ad').value);
        
        // Check if inputs are valid numbers
        if (!isNaN(firstServeIn) && !isNaN(firstServeOut) && (firstServeIn + firstServeOut !== 0)) {
            // Calculate the percentage and round it to the nearest integer
            var percentage = Math.round((firstServeIn / (firstServeIn + firstServeOut)) * 100);
            // Update the span with the calculated percentage
            document.getElementById('first_serve_in_percent_ad').value = percentage;
        } else {
            // If inputs are not valid, display an empty percentage
            document.getElementById('first_serve_in_percent_ad').value = "";
        }

        calculateFirstServe();
        calculateFirstServePercentage();
    }

    // Add event listeners to the input fields
    document.getElementById('first_serve_in_ad').addEventListener('input', calculateFirstServePercentageAd);
    document.getElementById('first_serve_out_ad').addEventListener('input', calculateFirstServePercentageAd);

    // ============== second serve
    function calculateSecondServe() {
        var firstServeInDeuce = parseFloat(document.getElementById('second_serve_in_deuce').value);
        var firstServeOutDeuce = parseFloat(document.getElementById('second_serve_out_deuce').value);
        var firstServeInAd = parseFloat(document.getElementById('second_serve_in_ad').value);
        var firstServeOutAd = parseFloat(document.getElementById('second_serve_out_ad').value);

        var firstServeIn = (isNaN(firstServeInDeuce) ? 0 : firstServeInDeuce) + (isNaN(firstServeInAd) ? 0 : firstServeInAd);
        if (firstServeIn > 0) {
            document.getElementById('second_serve_in').value = firstServeIn;
        }

        var firstServeOut = (isNaN(firstServeOutDeuce) ? 0 : firstServeOutDeuce) + (isNaN(firstServeOutAd) ? 0 : firstServeOutAd);
        if (firstServeOut > 0) {
            document.getElementById('second_serve_out').value = firstServeOut;
        }
    }

    // Second Deuce
    function calculateSecondServePercentageDeuce() {
        var firstServeIn = parseFloat(document.getElementById('second_serve_in_deuce').value);
        var firstServeOut = parseFloat(document.getElementById('second_serve_out_deuce').value);
        
        // Check if inputs are valid numbers
        if (!isNaN(firstServeIn) && !isNaN(firstServeOut) && (firstServeIn + firstServeOut !== 0)) {
            // Calculate the percentage and round it to the nearest integer
            var percentage = Math.round((firstServeIn / (firstServeIn + firstServeOut)) * 100);
            // Update the span with the calculated percentage
            document.getElementById('second_serve_in_percent_deuce').value = percentage;
        } else {
            // If inputs are not valid, display an empty percentage
            document.getElementById('second_serve_in_percent_deuce').value = "";
        }

        calculateSecondServe();
        calculateSecondServePercentage();
    }

    // Add event listeners to the input fields
    document.getElementById('second_serve_in_deuce').addEventListener('input', calculateSecondServePercentageDeuce);
    document.getElementById('second_serve_out_deuce').addEventListener('input', calculateSecondServePercentageDeuce);

    function calculateSecondServePercentageAd() {
        var firstServeIn = parseFloat(document.getElementById('second_serve_in_ad').value);
        var firstServeOut = parseFloat(document.getElementById('second_serve_out_ad').value);
        
        // Check if inputs are valid numbers
        if (!isNaN(firstServeIn) && !isNaN(firstServeOut) && (firstServeIn + firstServeOut !== 0)) {
            // Calculate the percentage and round it to the nearest integer
            var percentage = Math.round((firstServeIn / (firstServeIn + firstServeOut)) * 100);
            // Update the span with the calculated percentage
            document.getElementById('second_serve_in_percent_ad').value = percentage;
        } else {
            // If inputs are not valid, display an empty percentage
            document.getElementById('second_serve_in_percent_ad').value = "";
        }

        calculateSecondServe();
        calculateSecondServePercentage();
    }

    // Add event listeners to the input fields
    document.getElementById('second_serve_in_ad').addEventListener('input', calculateSecondServePercentageAd);
    document.getElementById('second_serve_out_ad').addEventListener('input', calculateSecondServePercentageAd);
</script>

    {% block bottom_part %}
    {% endblock %}

{% endblock %}